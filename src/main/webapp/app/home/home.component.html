<!-- Новый дашборд The Forge -->
<div class="dashboard">
  <!-- Приветствие -->
  <div class="welcome-section">
    @if (account(); as accountRef) {
      <h1 class="welcome-title">{{ 'home.welcome.title' | translate }}, {{ accountRef.firstName || accountRef.login }}!</h1>
      <p class="welcome-subtitle">{{ 'home.welcome.subtitle' | translate }}</p>
    } @else {
      <h1 class="welcome-title">{{ 'home.welcome.title' | translate }}</h1>
      <p class="welcome-subtitle">{{ 'home.welcome.subtitle' | translate }}</p>
    }
  </div>

  @if (account() !== null) {
    <!-- Статистика за сегодня -->
    <div class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon success">
            <fa-icon icon="users"></fa-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ activeEmployeesCount() }}</div>
            <div class="stat-label">{{ 'home.stats.activeEmployees' | translate }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon warning">
            <fa-icon icon="tasks"></fa-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ activeTasksCount() }}</div>
            <div class="stat-label">{{ 'home.stats.activeTasks' | translate }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon info">
            <fa-icon icon="graduation-cap"></fa-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ upcomingInstructions().length }}</div>
            <div class="stat-label">{{ 'home.stats.upcomingTrainings' | translate }}</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon danger">
            <fa-icon icon="exclamation-triangle"></fa-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ requiresAttentionCount() }}</div>
            <div class="stat-label">{{ 'home.stats.requiresAttention' | translate }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Виджеты дашборда -->
    <div class="widgets-section">
      <div class="widgets-grid">
        <!-- Ближайшие инструктажи -->
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">{{ 'home.widgets.upcomingTrainings' | translate }}</h3>
            <a routerLink="/safety-instruction" class="widget-link">{{ 'home.widgets.allTrainings' | translate }}</a>
          </div>
          <div class="widget-content">
            @for (it of upcomingInstructions() | slice: 0 : maxTrainings(); track $index) {
              <div class="instruction-item">
                <div class="instruction-info">
                  <div class="instruction-title">{{ it.title }}</div>
                  <div class="instruction-date">{{ it.dateLabel }}</div>
                </div>
                <div class="instruction-progress">
                  <div class="progress-bar" style="width: 60%"></div>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Активные задачи -->
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">{{ 'home.widgets.priorityTasks' | translate }}</h3>
            <a routerLink="/task" class="widget-link">{{ 'home.widgets.allTasks' | translate }}</a>
          </div>
          <div class="widget-content">
            @for (t of priorityTasks() | slice: 0 : maxTasks(); track $index) {
              <div class="task-item {{ t.cssClass }}">
                <div class="task-priority"></div>
                <div class="task-info">
                  <div class="task-title">{{ t.title }}</div>
                  <div class="task-assignee">{{ t.assigneeLabel }}</div>
                </div>
                <div class="task-status {{ t.cssClass }}">{{ 'global.TaskPriority.' + t.priorityKey | translate }}</div>
              </div>
            }
          </div>
        </div>

        <!-- Календарь -->
        <div class="widget-card">
          <div class="widget-header">
            <h3 class="widget-title">{{ 'home.widgets.calendarEvents' | translate }}</h3>
            <a routerLink="/calendar" class="widget-link">{{ 'home.widgets.openCalendar' | translate }}</a>
          </div>
          <div class="widget-content">
            <div class="mini-calendar">
              <div class="calendar-events">
                @for (e of calendarEvents() | slice: 0 : maxMeetings(); track $index) {
                  <div class="event-item">
                    <div class="event-date">{{ e.day }}</div>
                    <div class="event-title">{{ e.title }}</div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <!-- Страница для неавторизованных пользователей -->
    <div class="auth-section">
      <div class="auth-card">
        <h2>{{ 'home.welcome.title' | translate }}</h2>
        <p>{{ 'home.welcome.description' | translate }}</p>

        <div class="auth-actions">
          <button class="btn-forge-primary" (click)="login()">{{ 'home.welcome.loginButton' | translate }}</button>
          <a routerLink="/account/register" class="btn-forge-secondary">{{ 'home.welcome.registerButton' | translate }}</a>
        </div>

        <div class="demo-accounts">
          <p>
            <strong>{{ 'home.welcome.demoAccounts' | translate }}</strong>
          </p>
          <ul>
            <li>{{ 'home.welcome.adminAccount' | translate }}</li>
            <li>{{ 'home.welcome.userAccount' | translate }}</li>
          </ul>
        </div>
      </div>
    </div>
  }
</div>
