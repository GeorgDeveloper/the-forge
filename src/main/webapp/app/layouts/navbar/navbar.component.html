<!-- Новый верхний навбар -->
<nav data-cy="navbar" class="top-navbar">
  <div class="navbar-container">
    <!-- Мобильная кнопка меню -->
    <button class="mobile-menu-toggle d-lg-none" (click)="toggleNavbar()" aria-label="Toggle navigation">
      <fa-icon icon="bars"></fa-icon>
    </button>

    <!-- Поиск по системе -->
    <div class="search-container">
      <div class="search-input-wrapper">
        <fa-icon icon="search" class="search-icon"></fa-icon>
        <input
          type="text"
          class="search-input"
          [placeholder]="'global.search.placeholder' | translate"
          [(ngModel)]="searchQuery"
          (keyup.enter)="performSearch()"
        />
      </div>
    </div>

    <!-- Правая часть навбара -->
    <div class="navbar-actions">
      <!-- Переключатель языка -->
      <button class="lang-toggle" (click)="toggleLanguage()" title="Switch Language">
        <span class="flag" [class.ru]="currentLang === 'ru'" [class.us]="currentLang !== 'ru'"></span>
        <span class="lang-label">{{ currentLang === 'ru' ? 'RU' : 'EN' }}</span>
      </button>
      <!-- Профиль пользователя -->
      <div ngbDropdown class="user-profile-dropdown" display="dynamic" placement="bottom-right">
        @let accountRef = account();
        <button class="profile-button" ngbDropdownToggle id="account-menu" data-cy="accountMenu">
          @if (!accountRef?.imageUrl) {
            <div class="profile-avatar">
              {{ accountRef?.firstName?.charAt(0) || 'U' }}
            </div>
          } @else {
            <img [src]="accountRef!.imageUrl" class="profile-image" alt="Avatar" />
          }
          <div class="profile-info d-none d-md-block">
            <div class="profile-name">{{ accountRef?.firstName }} {{ accountRef?.lastName }}</div>
            <div class="profile-role">{{ accountRef?.authorities?.[0] || 'Пользователь' }}</div>
          </div>
        </button>

        <ul class="dropdown-menu profile-dropdown-menu" ngbDropdownMenu aria-labelledby="account-menu">
          @if (accountRef !== null) {
            <li>
              <a
                class="dropdown-item"
                routerLink="/account/settings"
                routerLinkActive="active"
                (click)="collapseNavbar()"
                data-cy="settings"
              >
                <fa-icon icon="wrench" [fixedWidth]="true"></fa-icon>
                <span jhiTranslate="global.menu.account.settings">Настройки</span>
              </a>
            </li>
            <li>
              <a
                class="dropdown-item"
                routerLink="/account/password"
                routerLinkActive="active"
                (click)="collapseNavbar()"
                data-cy="passwordItem"
              >
                <fa-icon icon="lock" [fixedWidth]="true"></fa-icon>
                <span jhiTranslate="global.menu.account.password">Пароль</span>
              </a>
            </li>
            <li class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" (click)="logout()" id="logout" data-cy="logout">
                <fa-icon icon="sign-out-alt" [fixedWidth]="true"></fa-icon>
                <span jhiTranslate="global.menu.account.logout">Выйти</span>
              </a>
            </li>
          } @else {
            <li>
              <a class="dropdown-item" (click)="login()" id="login" data-cy="login">
                <fa-icon icon="sign-in-alt" [fixedWidth]="true"></fa-icon>
                <span jhiTranslate="global.menu.account.login">Войти</span>
              </a>
            </li>
            <li>
              <a
                class="dropdown-item"
                routerLink="/account/register"
                routerLinkActive="active"
                (click)="collapseNavbar()"
                data-cy="register"
              >
                <fa-icon icon="user-plus" [fixedWidth]="true"></fa-icon>
                <span jhiTranslate="global.menu.account.register">Зарегистрироваться</span>
              </a>
            </li>
          }
        </ul>
      </div>
    </div>
  </div>
</nav>
